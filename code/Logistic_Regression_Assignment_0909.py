# μΆ…μ†λ³€μ: λ°±νλ³‘ μ„Έν¬ κ΄€μΈ΅ λ¶κ°€ μ—¬λ¶€ (REMISS), 1μ΄λ©΄ κ΄€μΈ΅ μ•λ¨μ„ μλ―Έ

# λ…λ¦½λ³€μ:
# κ³¨μμ μ„Έν¬μ„± (CELL)
# κ³¨μνΈμ λ°±νκµ¬ λΉ„μ¨ (SMEAR)
# κ³¨μμ λ°±νλ³‘ μ„Έν¬ μΉ¨ν¬ λΉ„μ¨ (INFIL)
# κ³¨μ λ°±νλ³‘ μ„Έν¬μ λΌλ²¨λ§ μΈλ±μ¤ (LI)
# λ§μ΄νμ•΅μ λ°±νλ³‘ μ„Έν¬ μ (BLAST)
# μΉλ£ μ‹μ‘ μ „ μµκ³  μ²΄μ¨ (TEMP)


## λ¬Έμ  1.
## λ°μ΄ν„°λ¥Ό λ΅λ“ν•κ³ , λ΅μ§€μ¤ν‹± νκ·€λ¨λΈμ„ μ ν•©ν•κ³ , νκ·€ ν‘λ¥Ό μ‘μ„±ν•μ„Έμ”.

# λ°μ΄ν„° λ΅λ“
import pandas as pd

df = pd.read_csv('../data/leukemia_remission.txt', delim_whitespace= True) # delim_whitespace : κ³µλ°± μ§€μ°κΈ°
df.head()

train = df.drop(columns=('REMISS')) # λ…λ¦½λ³€μλ§

# λ΅μ§€μ¤ν‹± νκ·€λ¨λΈ μ ν•©, νκ·€ ν‘ μ‘μ„±
import statsmodels.api as sm
model = sm.formula.logit("REMISS ~ CELL + SMEAR + INFIL + LI + BLAST + TEMP", data=df).fit()
print(model.summary())


## λ¬Έμ  2.
## ν•΄λ‹Ή λ¨λΈμ€ ν†µκ³„μ μΌλ΅ μ μν•κ°€μ”? κ·Έ μ΄μ λ¥Ό κ²€μ •ν†µκ³„λ‰λ¥Ό μ‚¬μ©ν•΄μ„ μ„¤λ…ν•μ‹μ¤.
# β’2(β„“(π›½)Μ‚ (0) β’ β„“(π›½)Μ‚ )  =  -2*(-17.186+10.797)  = 12.779
from scipy.stats import chi2
1 - chi2.cdf(12.779, df=6)  # 0.0466828104726148

# LLR p-value: 0.0467 < μ μμμ¤€ 0.05λ³΄λ‹¤ μ‘μΌλ‹κΉ ν†µκ³„μ μΌλ΅ μ μν•λ‹¤κ³  ν•  μ μλ‹¤.


# λ¬Έμ  3.
# μ μμμ¤€μ΄ 0.2λ¥Ό κΈ°μ¤€μΌλ΅ ν†µκ³„μ μΌλ΅ μ μν• λ³€μλ” λ‡κ°μ΄λ©°, μ–΄λ λ³€μ μΈκ°€μ”?
# P>|z|κ°€ 0.2λ³΄λ‹¤ μ‘μ€ LI, TEMPκ°€ μ μν•λ‹¤


# λ¬Έμ  4. λ‹¤μ ν™μμ— λ€ν• μ¤μ¦λ” μ–Όλ§μΈκ°€μ”?
# CELL (κ³¨μμ μ„Έν¬μ„±): 65%
# SMEAR (κ³¨μνΈμ λ°±νκµ¬ λΉ„μ¨): 45%
# INFIL (κ³¨μμ λ°±νλ³‘ μ„Έν¬ μΉ¨ν¬ λΉ„μ¨): 55%
# LI (κ³¨μ λ°±νλ³‘ μ„Έν¬μ λΌλ²¨λ§ μΈλ±μ¤): 1.2
# BLAST (λ§μ΄νμ•΅μ λ°±νλ³‘ μ„Έν¬ μ): 1.1μ„Έν¬/ΞΌL
# TEMP (μΉλ£ μ‹μ‘ μ „ μµκ³  μ²΄μ¨): 0.9

import numpy as np
log_odds=64.2581 + 30.8301*0.65 + 24.6863*0.45 + -24.9745*0.55 + 4.3605*1.2 + -0.0115*1.1 + -100.1734*0.9
odds = np.exp(log_odds) # 0.03817459641135519


## λ¬Έμ  5. μ„ ν™μμ νμ•΅μ—μ„ λ°±νλ³‘ μ„Έν¬κ°€ κ΄€μΈ΅λμ§€ μ•μ€ ν™•λ¥ μ€ μ–Όλ§μΈκ°€μ”?
p_hat = odds / (odds + 1) # 0.03677088280074742


# λ¬Έμ  6. TEMP λ³€μμ κ³„μλ” μ–Όλ§μ΄λ©°, ν•΄λ‹Ή κ³„μλ¥Ό μ‚¬μ©ν•΄μ„ TEMP λ³€μκ°€ λ°±νλ³‘ μΉλ£μ— λ€ν• μν–¥μ„ μ„¤λ…ν•μ‹μ¤.
-100.1734
μ²΄μ¨μ΄ μ¦κ°€ν• μλ΅ λ°±νλ³‘ μΉλ£μ— λ¶€μ •μ μΈ μν–¥μ„ λ―ΈμΉ©λ‹λ‹¤
μ²΄μ¨μ΄ 1λ„ μƒμΉν•  λ•λ§λ‹¤ λ°±νλ³‘ μ„Έν¬κ°€ κ΄€μΈ΅λμ§€ μ•μ„ κ°€λ¥μ„±μ€ κΈ‰κ²©ν μ¤„μ–΄λ“¤κ² λ©λ‹λ‹¤.
μ΄λ” κ³ μ—΄μ΄ λ°±νλ³‘ μΉλ£ μ„±κ³µμ— λ°©ν•΄κ°€ λ  μ μμμ„ μλ―Έν•©λ‹λ‹¤.

## λ¬Έμ  7. CELL λ³€μμ 99% μ¤μ¦λΉ„μ— λ€ν• μ‹ λΆ°κµ¬κ°„μ„ κµ¬ν•μ‹μ¤.
# 99% μ¤μ¦λΉ„ μ‹ λΆ°κµ¬κ°„ κ³„μ‚°
odds_ratios = np.exp(model.params)
conf = model.conf_int()
conf = np.exp(conf)

# CELL λ³€μμ μ‹ λΆ° κµ¬κ°„
cell_confidence_interval = conf.loc['CELL']
print(f"CELL λ³€μμ 99% μ¤μ¦λΉ„ μ‹ λΆ°κµ¬κ°„: {cell_confidence_interval}")

#CELL λ³€μμ 99% μ¤μ¦λΉ„ μ‹ λΆ°κµ¬κ°„: 
#0    1.027206e-31
#1    5.847804e+57




λ¬Έμ  8. μ£Όμ–΄μ§„ λ°μ΄ν„°μ— λ€ν•μ—¬ λ΅μ§€μ¤ν‹± νκ·€ λ¨λΈμ μμΈ΅ ν™•λ¥ μ„ κµ¬ν• ν›„, 50% μ΄μƒμΈ κ²½μ° 1λ΅ μ²λ¦¬ν•μ—¬, νΌλ™ ν–‰λ ¬λ¥Ό κµ¬ν•μ‹μ¤.
pred_probs = model.predict(X)
predictions = (pred_probs >= 0.5).astype(int)

# νΌλ™ ν–‰λ ¬
conf_matrix = confusion_matrix(y, predictions)



λ¬Έμ  9. ν•΄λ‹Ή λ¨λΈμ Accuracyλ” μ–Όλ§μΈκ°€μ”?
accuracy = accuracy_score(y, predictions)


## λ¬Έμ  10. ν•΄λ‹Ή λ¨λΈμ F1 Scoreλ¥Ό κµ¬ν•μ„Έμ”.

precision = 5/(5+3)
recall = 5/(5+4)

2 / (1/precision + 1/recall)   # 0.5882352941176471

f1_score(df['REMISS'], result['result'])  # 0.5882352941176471